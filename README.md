# â˜€ï¸ æ™ºæ…§åž‹æ—¥ç…§æ„Ÿæ‡‰è‡ªå‹•æŽ§åˆ¶ç³»çµ± (Sprinkler-system)

æœ¬å°ˆæ¡ˆç‚ºä¸€å¥—åŸºæ–¼ 8051 å¾®æŽ§åˆ¶å™¨çš„è‡ªå‹•åŒ–æŽ§åˆ¶ç³»çµ±ï¼Œæ•´åˆäº† **BH1750 æ•¸ä½å…‰ç…§æ„Ÿæ¸¬å™¨** (I2C) èˆ‡ **SG90 ä¼ºæœé¦¬é”** (PWM)ã€‚ç³»çµ±èƒ½å¯¦æ™‚ç›£æ¸¬ç’°å¢ƒäº®åº¦ï¼Œä¸¦æ ¹æ“šé è¨­é–¾å€¼è‡ªå‹•åŸ·è¡Œå‹•ä½œï¼ˆå¦‚è‡ªå‹•é®é™½æˆ–å•Ÿå‹•ç‘æ°´ï¼‰ï¼ŒåŒæ™‚æ”¯æ´ UART é ç«¯ç›£æŽ§èª¿è©¦ã€‚

## ðŸ“‚ å°ˆæ¡ˆçµæ§‹

```text
Sprinkler-system/
â”œâ”€â”€ main.c              # ä¸»ç¨‹å¼é‚è¼¯ (ç³»çµ±åˆå§‹åŒ–ã€é–¥å€¼åˆ¤æ–·)
â””â”€â”€ README.md            # ç³»çµ±èªªæ˜Ž

```

## âœ… ç’°å¢ƒéœ€æ±‚èˆ‡ç¡¬é«”é…ç½®

* **å¾®æŽ§åˆ¶å™¨**: MPC82G516 (12MHz, 12T æ¨¡å¼)
* **ç·¨è­¯å·¥å…·**: Keil uVision3 / uVision5
* **ç¡¬é«”çµ„ä»¶**:
* **BH1750**: æ•¸ä½å…‰ç…§æ„Ÿæ¸¬å™¨ (æŽ¥è‡³ P3.0, P3.1)
* **SG90**: ä¼ºæœé¦¬é” (æŽ¥è‡³ P2.0)
* **UART-to-USB**: ç”¨æ–¼è¼¸å‡ºåµéŒ¯è³‡è¨Š (Baudrate: 9600)


* **é›»åŠ›ä¾›æ‡‰**: å»ºè­°é¦¬é”ä½¿ç”¨å¤–éƒ¨ 5V ä¾›é›»ï¼Œä¸¦èˆ‡ 8051 å…±åœ° (GND)ã€‚

## ðŸ›  æ ¸å¿ƒæŠ€è¡“èªªæ˜Ž

### 1. é é‹ç®— PWM é©…å‹•æŠ€è¡“ (Pre-calculation)

ç‚ºäº†ç¢ºä¿åœ¨ 8 ä½å…ƒ MCU ä¸Šè¼¸å‡ºç©©å®šçš„ PWM è¨Šè™Ÿè€Œä¸æŠ–å‹•ï¼Œç³»çµ±å°‡è¤‡é›œçš„ 32 ä½å…ƒç·šæ€§æ’å€¼é‹ç®—ç§»è‡³ **Main Loop** åŸ·è¡Œï¼Œ**ISR (ä¸­æ–·æœå‹™ç¨‹å¼)** åƒ…è² è²¬æ•¸å€¼è£è¼‰ï¼Œå¤§å¹…é™ä½Ž CPU è² æ“”ã€‚

### 2. å¤šè¨ˆæ™‚å™¨è³‡æºé…ç½® (Resource Management)

* **Timer 0**: ç³»çµ±å¿ƒè·³è¨ˆæ™‚å™¨ï¼Œæ¯ 200ms å®šæ™‚è¼ªè©¢æ„Ÿæ¸¬å™¨ã€‚
* **Timer 2**: å°ˆè·è™•ç† 50Hz PWM è¼¸å‡ºï¼Œæä¾› 1Î¼s ç­‰ç´šçš„é«˜ç²¾åº¦æŽ§åˆ¶ã€‚
* **Software Delay**: é€éŽ NOP æŒ‡ä»¤å¯¦ä½œ I2C å¾®ç§’å»¶é²ï¼Œç¢ºä¿é€šè¨Šä¸å¹²æ“¾é¦¬é”é‹ä½œã€‚

## ðŸ”§ å®‰è£èˆ‡åŸ·è¡Œæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç¡¬é«”æŽ¥ç·š

* å°‡ BH1750 çš„ **SDA/SCL** åˆ†åˆ¥é€£æŽ¥è‡³ **P3.0/P3.1**ã€‚
* å°‡ SG90 çš„ **PWM è¨Šè™Ÿç·š** é€£æŽ¥è‡³ **P2.0**ã€‚

### ç¬¬äºŒæ­¥ï¼šç·¨è­¯èˆ‡ç‡’éŒ„

1. é–‹å•Ÿ Keil uVisionï¼ŒåŒ¯å…¥å°ˆæ¡ˆæª”æ¡ˆã€‚
2. é»žæ“Š `Build` ç”Ÿæˆ `.hex` æª”æ¡ˆã€‚
3. ä½¿ç”¨ ISP ç‡’éŒ„å·¥å…·ï¼ˆå¦‚ MPC82G ISP Programmerï¼‰å°‡ç¨‹å¼ç‡’éŒ„è‡³æ™¶ç‰‡ã€‚

### ç¬¬ä¸‰æ­¥ï¼šé ç«¯ç›£æŽ§

ä½¿ç”¨ä¸²å£èª¿è©¦åŠ©æ‰‹ï¼ˆå¦‚ Serial Port Utilityï¼‰é–‹å•Ÿå°æ‡‰ COM åŸ ï¼Œæ³¢ç‰¹çŽ‡è¨­å®šç‚º `9600`ã€‚ç³»çµ±å°‡å¯¦æ™‚è¼¸å‡ºç•¶å‰äº®åº¦èˆ‡é¦¬é”ç‹€æ…‹ï¼š

```text
[SYSTEM] Initialized.
[SENSOR] bh1750 = 00101101 (Lux: 45)
[ACTION] Light Low. Servo -> 0Â°

```

---
